{% extends "layout.html" %}
{% block content %}
<h2>관리자 페이지</h2>

<h3>1) 입금 확인이 필요한 주문</h3>
<div class="row g-3">
  {% for o in pending_orders %}
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">주문 {{ o.id }}</h5>
        <p class="card-text">
          테이블: {{ o.tableNumber }}<br/>
          총액: {{ o.totalPrice }}원
        </p>
        <form action="{{ url_for('admin_confirm', order_id=o.id) }}"
              method="POST">
          <button class="btn btn-success w-100">입금확인</button>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
  {% if pending_orders|length == 0 %}
    <p class="text-muted">대기중인 주문이 없습니다.</p>
  {% endif %}
</div>

<hr/>
<h3>2) 조리 중인 주문</h3>
{% for o in paid_orders %}
  <div class="card mb-3">
    <div class="card-header">
      주문 {{ o.id }} / 테이블: {{ o.tableNumber }}
    </div>
    <div class="card-body">
      <ul>
        {% for i in o['items'] %}
        <li>
          메뉴ID {{ i.menuId }} /
          주문수량 {{ i.quantity }} /
          조리완료 {{ i.doneQuantity }} /
          전달됨 {{ i.deliveredQuantity|default(0) }}
          {% if i.doneQuantity > (i.deliveredQuantity|default(0)) %}
            <form action="{{ url_for('admin_deliver_item', order_id=o.id, menu_id=i.menuId) }}"
                  method="POST" style="display:inline;">
              <button class="btn btn-sm btn-primary">전달</button>
            </form>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endfor %}
{% if paid_orders|length == 0 %}
  <p class="text-muted">확정된 주문이 없습니다.</p>
{% endif %}

<hr/>
<h3>3) 조리 완료된 주문(과거 주문)</h3>
<ul class="list-group">
  {% for o in completed_orders %}
  <li class="list-group-item">
    주문 {{ o.id }} / 테이블 {{ o.tableNumber }} / {{ o.totalPrice }}원 (완료됨)
  </li>
  {% endfor %}
  {% if completed_orders|length == 0 %}
    <li class="list-group-item text-muted">완료된 주문이 없습니다.</li>
  {% endif %}
</ul>

<hr/>
<h3>4) 메뉴 품절 처리</h3>
<table class="table table-striped">
  <thead><tr>
    <th>메뉴명</th><th>가격</th><th>상태</th><th>동작</th>
  </tr></thead>
  <tbody>
    {% for m in menu_items %}
    <tr>
      <td>{{ m.name }}</td>
      <td>{{ m.price }}원</td>
      <td>{{ "품절" if m.soldOut else "재고있음" }}</td>
      <td>
        <form action="{{ url_for('admin_soldout', menu_id=m.id) }}" method="POST">
          <button class="btn btn-sm btn-outline-{{ 'success' if m.soldOut else 'danger' }}">
            {{ "해제" if m.soldOut else "품절처리" }}
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
