{% extends "layout.html" %}
{% block content %}
<h2 class="mb-3"><i class="fas fa-user-shield"></i> 관리자 페이지</h2>

<!-- 1) 입금 확인 -->
<h4>✅ 입금 확인 필요</h4>
<div class="row g-3">
  {% for o in pending_orders %}
  <div class="col-md-4">
    <div class="card shadow-sm">
      <div class="card-body">
        <h5 class="card-title">주문 {{ o.id }}</h5>
        <p class="card-text">
          테이블: {{ o.tableNumber }}<br>
          총액: {{ o.totalPrice }}원
        </p>
        <button
          class="btn btn-success w-100"
          hx-post="{{ url_for('admin_confirm',order_id=o.id) }}"
          hx-swap="outerHTML"
          hx-target=".card"
        >
          <i class="fas fa-check"></i> 확정
        </button>
      </div>
    </div>
  </div>
  {% endfor %}
  {% if not pending_orders %}
    <p class="text-muted">대기중인 주문이 없습니다.</p>
  {% endif %}
</div>

<!-- 2) 조리 중 -->
<h4 class="mt-4">👩‍🍳 조리 중</h4>
<ul class="list-group">
  {% for o in paid_orders %}
  <li class="list-group-item d-flex justify-content-between align-items-center">
    <div>
      <strong>{{ o.id }}</strong> / 테이블 {{ o.tableNumber }}
      {% if o.kitchenDone %}
        <span class="badge bg-success">완료</span>
      {% else %}
        <span class="badge bg-warning text-dark">진행중</span>
      {% endif %}
    </div>
    <form method="POST" action="{{ url_for('admin_complete',order_id=o.id) }}">
      <button class="btn btn-outline-primary btn-sm">
        <i class="fas fa-clipboard-check"></i> 최종 완료
      </button>
    </form>
  </li>
  {% endfor %}
  {% if not paid_orders %}
    <li class="list-group-item text-muted">확정된 주문이 없습니다.</li>
  {% endif %}
</ul>

<!-- 3) 과거 주문 -->
<h4 class="mt-4">📜 완료된 주문</h4>
<ul class="list-group">
  {% for o in completed_orders %}
  <li class="list-group-item">
    {{ o.id }} / 테이블 {{ o.tableNumber }} / {{ o.totalPrice }}원 (완료됨)
  </li>
  {% endfor %}
  {% if not completed_orders %}
    <li class="list-group-item text-muted">완료된 주문이 없습니다.</li>
  {% endif %}
</ul>

<hr class="my-4">

<!-- 품절 토글 -->
<h4>🍽️ 메뉴 품절 관리</h4>
<table class="table table-striped">
  <thead><tr>
    <th>메뉴</th><th>가격</th><th>상태</th><th>동작</th>
  </tr></thead>
  <tbody>
    {% for m in menu_items %}
    <tr>
      <td>{{ m.name }}</td>
      <td>{{ m.price }}원</td>
      <td>
        {% if m.soldOut %}
          <span class="text-danger">품절</span>
        {% else %}
          <span class="text-success">재고 있음</span>
        {% endif %}
      </td>
      <td>
        <form method="POST" action="{{ url_for('admin_soldout',menu_id=m.id) }}">
          <button class="btn btn-outline-{{ 'danger' if not m.soldOut else 'success' }} btn-sm">
            {{ '품절 처리' if not m.soldOut else '해제' }}
          </button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
